<extend name="Public:base" />
<block name="header_js">
</block>

<block name="content">
	<div class="layui-field-box">
    
    	<div class="row">
            <div class="col-lg-12">
                <h3 class="page-header"><i class="layui-icon" style="font-size:20px;">&#xe654;</i> 
                添加采集规则  
                </h3>
            </div>
            
        </div>
    	
        <form method="post" class="layui-form form-container" id="form_do" data-url="{:U('add')}">
                    
            <div class="layui-form-item">
                <label class="layui-form-label">规则名称</label>
                <div class="layui-input-inline" style="width:50%;">
                    <input type="text" name="title" value="" required lay-verify="required" placeholder="规则名称" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">网站域名</label>
                <div class="layui-input-inline" style="width:50%;">
                    <input type="text" name="site" value="http://" required lay-verify="required" placeholder="网站域名，如：http://www.xxoo.com" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">列表页面地址</label>
                <div class="layui-input-inline" style="width:50%;">
                    <input type="text" name="listurl" value="http://" required lay-verify="required" placeholder="列表页面地址" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">所属栏目</label>
                <div class="layui-input-inline">
                    <select name="cid" >
                        <option value="0">请选择</option>
                        <foreach name='cate' item='v'>
                        <option value="{$v.id}">{$v.delimiter}{$v.name}</option>
                        </foreach>
                    </select>
                </div>
            </div>
            
            <!--<div class="layui-form-item">
                <label class="layui-form-label">列表区域匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="listpreg" class="layui-textarea"></textarea>
                </div>
            </div>-->
            
            <div class="layui-form-item">
                <label class="layui-form-label">url列表匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="listapreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">分页参数</label>
                <div class="layui-input-inline">
                    <input type="text" name="page" value="" placeholder="分页参数" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">页面后缀</label>
                <div class="layui-input-inline">
                    <input type="text" name="ext" value="" placeholder="页面后缀，例如：.html" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">标题匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="titlepreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">关键词匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="keypreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">描述匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="descrippreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">正文匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="contentpreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
            	<label class="layui-form-label">采集类型</label>
            	<div class="layui-input-block">
                	<input type="radio" name="type" value="1" checked="checked" title="文章" />
                    <input type="radio" name="type" value="2" title="图片集" />
                    <input type="radio" name="type" value="3" title="资源下载" />
                    <input type="radio" name="type" value="4" title="ajax列表" />
                </div>
            </div>
            
            <div class="layui-form-item">
            	<label class="layui-form-label">网站编码</label>
            	<div class="layui-input-block">
                	<input type="radio" name="codetype" value="1" checked="checked" title="utf-8" />
                    <input type="radio" name="codetype" value="2" title="gbk" />
                    <input type="radio" name="codetype" value="3" title="gbk（iconv函数）转码" />
                </div>
            </div>
            
            <!--<div class="layui-form-item">
            	<label class="layui-form-label">图片采集方式</label>
            	<div class="layui-input-block">
                	<input type="radio" name="type" value="1" checked="checked" title="curl方式" />
                    <input type="radio" name="type" value="0" title="ob_get_contents方式" />
                </div>
            </div>
            <div class="layui-form-item">
            	<label class="layui-form-label"></label>
            	<div class="layui-input-block">
                	（提示：如果采集不到图片或者采集的图片损坏请选用ob_get_contents方式）
                </div>
            </div>-->
            
            <div class="layui-form-item">
                <label class="layui-form-label">缩略图匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="picpreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">图片集匹配规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="piclistpreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">资源下载地址规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="downpreg" class="layui-textarea">{$vo.downpreg}</textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">内容分页参数</label>
                <div class="layui-input-inline">
                    <input type="text" name="contentpage" value="" placeholder="内容分页参数" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">内容分页规则</label>
                <div class="layui-input-inline" style="width:60%;">
                    <textarea name="cppreg" class="layui-textarea"></textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">采集起始页设置</label>
                <div class="layui-input-inline">
                    <input type="text" name="firstpage" value="1" class="layui-input" placeholder="开始页" />
                </div>
                <div class="layui-input-inline" style="width:15px; height:38px; line-height:38px; text-align:center">
                    ~
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="lastpage" value="1" class="layui-input" placeholder="结束页"  />
                </div>
                <div class="layui-input-inline" style="width:15px; height:38px; line-height:38px; text-align:center">页</div>
            </div>
            
            <div class="layui-form-item">
            	<label class="layui-form-label"></label>
            	<div class="layui-input-inline"></div>
            </div>
                
            <div class="btable-paged" >
                <div class="layui-main">
                    <div class="formbtngroup">
                    <button class="layui-btn layui-btn-small" lay-submit="" lay-filter="formadd"><i class="layui-icon">&#xe618;</i>添加 </button>
                    <button onclick="history.go(-1);" class="layui-btn layui-btn-primary layui-btn-small"><i class="layui-icon">&#xe603;</i>返回 </button>
                    </div>
                 </div>
             </div>
         </form>
    </div>
    <script>
	layui.use(['form','upload','layer','element'],function(){
	  var form = layui.form()
	  ,jq = layui.jquery
	  ,element = layui.element();
	  
	  var url=jq('form').data('url');
	  form.on('submit(formadd)', function(data){
	    loading = layer.load(2, {
	      shade: [0.2,'#000']
	    });
	    //var param = data.field;
	    jq.post(url,jq('#form_do').serialize(),function(data){
	    	
	      if(data.status == 1){
	        layer.close(loading);
	        layer.msg(data.info, {icon: 1, time: 1000}, function(){
	          location.href = data.url;
	        });
	      }else{
	        layer.close(loading);
	        layer.msg(data.info, {icon: 2, anim: 6, time: 1000});
	      }
	    });
	    return false;
	  });
	
	});
	</script>
</block>